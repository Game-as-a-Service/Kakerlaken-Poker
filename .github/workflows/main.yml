name: ðŸ‘· Main

on:
  push:
    branches: [main]

jobs:
  check_merge:
    runs-on: ubuntu-latest
    outputs:
      is_merge: ${{ steps.check_merge_commit.outputs.is_merge }}
    steps:
      - name: Check if it's a merge commit
        id: check_merge_commit
        run: |
          latest_commit="${{ github.sha }}"
          commit_message=$(git log --format=%B -n 1 $latest_commit)
          if [[ $commit_message == *"Merge branch"* ]]; then
            is_merge=true
          else
            is_merge=false
          fi
          echo "is_merge=${is_merge}" >> $GITHUB_OUTPUT

  push_main:
    needs: check_merge
    if: needs.check_merge.outputs.is_merge == 'false'
    uses: ./.github/workflows/pushMain.yml
    secrets: inherit

  merge_notify:
    needs: check_merge
    if: needs.check_merge.outputs.is_merge == 'true' && always()
    uses: ./.github/workflows/mergeNotify.yml
    secrets: inherit
